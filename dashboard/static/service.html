<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AutoSRE Operations â€” Service</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: system-ui, sans-serif; max-width: 720px; margin: 2rem auto; padding: 1rem; }
    h1 { font-size: 1.25rem; margin-bottom: 0.5rem; }
    nav { margin-bottom: 1rem; }
    nav a { color: #2563eb; text-decoration: none; margin-right: 1rem; }
    .tabs { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
    .tabs a { padding: 0.5rem 1rem; border: 1px solid #e5e7eb; border-radius: 6px; text-decoration: none; color: #374151; }
    .tabs a.active { background: #2563eb; color: white; border-color: #2563eb; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 0.5rem 0.75rem; text-align: left; border-bottom: 1px solid #e5e7eb; }
    th { font-weight: 600; }
    .btn-rollback { padding: 0.35rem 0.75rem; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.875rem; }
    .btn-rollback:hover { background: #b91c1c; }
    .panel { display: none; }
    .panel.active { display: block; }
  </style>
</head>
<body>
  <nav>
    <a href="/services">Services</a>
  </nav>
  <h1 id="service-title">Service</h1>
  <div class="tabs">
    <a href="#overview" class="tab active" data-panel="overview">Overview</a>
    <a href="#deployments" class="tab" data-panel="deployments">Deployments</a>
    <a href="#instances" class="tab" data-panel="instances">Instances</a>
    <a href="#scaling" class="tab" data-panel="scaling">Scaling</a>
  </div>
  <div id="overview" class="panel active">
    <p>Service overview and health.</p>
  </div>
  <div id="deployments" class="panel">
    <table>
      <thead>
        <tr><th>Version</th><th>Timestamp</th><th>Status</th><th>Action</th></tr>
      </thead>
      <tbody id="deployments-tbody">
      </tbody>
    </table>
  </div>
  <div id="instances" class="panel">
    <p>Instance list (demo).</p>
  </div>
  <div id="scaling" class="panel">
    <p>Scaling settings (demo).</p>
  </div>
  <script>
    (function() {
      var path = window.location.pathname;
      var parts = path.split('/');
      var serviceId = parts[parts.length - 1];
      if (!serviceId || serviceId === 'service.html') {
        serviceId = 'checkout';
      }
      document.getElementById('service-title').textContent = serviceId.charAt(0).toUpperCase() + serviceId.slice(1);

      fetch('/api/services/' + serviceId)
        .then(function(r) { return r.json(); })
        .then(function(data) {
          var tbody = document.getElementById('deployments-tbody');
          (data.deployments || []).forEach(function(d) {
            var tr = document.createElement('tr');
            var version = d.version || '';
            tr.innerHTML = '<td>' + version + '</td><td>' + (d.timestamp || '') + '</td><td>' + (d.status || '') + '</td><td>' +
              '<button class="btn-rollback" type="button" data-version="' + version + '">Rollback</button></td>';
            tbody.appendChild(tr);
          });
          tbody.addEventListener('click', function(e) {
            if (e.target.classList.contains('btn-rollback')) {
              var toVersion = e.target.getAttribute('data-version');
              fetch('/api/services/' + serviceId + '/rollback', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ to_version: toVersion })
              }).then(function(r) { return r.json(); }).then(function() {
                e.target.disabled = true;
                e.target.textContent = 'Rolled back';
              });
            }
          });
        });

      document.querySelectorAll('.tab').forEach(function(tab) {
        tab.addEventListener('click', function(e) {
          e.preventDefault();
          document.querySelectorAll('.tab').forEach(function(t) { t.classList.remove('active'); });
          document.querySelectorAll('.panel').forEach(function(p) { p.classList.remove('active'); });
          tab.classList.add('active');
          var panelId = tab.getAttribute('data-panel');
          var panel = document.getElementById(panelId);
          if (panel) panel.classList.add('active');
        });
      });
    })();
  </script>
</body>
</html>
